name: "Regenerate tags"

permissions:
  contents: write
  actions: write
  pull-requests: write

on:
  workflow_dispatch:
  schedule:
    # Picked the same time as codeql because *surely* there is a reason for this
    - cron: "36 2 1 * *"

jobs:
  Regenerate-Tags:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          # Pinned Python version
          python-version-file: ".python-version"
      - name: Install uv
        uses: astral-sh/setup-uv@v7
        with:
          enable-cache: true
      - name: Regenerate tag definitions
        run: |
          uv run -m generator
      - name: Create pull request
        uses: peter-evans/create-pull-request@v8
        with:
          commit-message: Regenerate tags
          author: ${{ github.actor }} <${{ github.actor_id }}+${{ github.actor }}@users.noreply.github.com>
          signoff: false
          branch: actions-regenerate-tags
          delete-branch: true
          title: "Regenerate tags"
          body: |
            Regenerate tags for PyHTML by running `uv run -m generator`

            This pull-request was auto-generated.
          labels: |
            documentation
          assignees: MaddyGuthridge
          reviewers: MaddyGuthridge
